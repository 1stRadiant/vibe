<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibe Coding System | No-Code AI Builder</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Custom Stylesheet -->
    <link rel="stylesheet" href="style.css">
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <style>
        :root {
            --bg-dark: #1e1e1e;
            --bg-panel: #252526;
            --bg-header: #2d2d2d;
            --accent-primary: #0d6efd;
            --accent-ai: #8a2be2; /* AI Purple */
            --text-primary: #cccccc;
            --border-color: #3e3e42;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }

        /* --- NO-CODE EDITOR STYLES --- */
        
        /* Node Card Styling */
        .vibe-node {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: border-color 0.2s;
        }

        .vibe-node:hover {
            border-color: #555;
        }

        .vibe-node.swap-selected {
            border: 2px dashed var(--accent-primary);
            background: rgba(13, 110, 253, 0.1);
        }

        .vibe-node-header {
            padding: 8px 12px;
            background: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
            border-radius: 6px 6px 0 0;
        }

        .drag-handle {
            cursor: grab;
            color: #666;
            font-size: 1.2rem;
            line-height: 1;
        }
        .drag-handle:hover { color: #fff; }

        .vibe-node .id {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9rem;
            color: #fff;
            font-weight: 600;
            flex-grow: 1;
        }

        .vibe-node .type {
            font-size: 0.75rem;
            padding: 2px 6px;
            background: #333;
            border-radius: 4px;
            color: #aaa;
            text-transform: uppercase;
        }

        .vibe-node-content {
            padding: 12px;
        }

        .description-input {
            background: #111;
            border: 1px solid #333;
            color: #ddd;
            width: 100%;
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        /* Generated Controls Grid */
        .vibe-node-controls {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
            border: 1px solid #333;
        }

        .control-wrapper {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .control-wrapper label {
            font-size: 0.8rem;
            color: #aaa;
        }

        .control-wrapper input[type="text"],
        .control-wrapper input[type="number"],
        .control-wrapper select {
            background: #2a2a2a;
            border: 1px solid #444;
            color: white;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.9rem;
        }

        .control-wrapper input[type="color"] {
            width: 100%;
            height: 30px;
            padding: 0;
            border: none;
            cursor: pointer;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .slider-container input[type="range"] {
            flex-grow: 1;
        }
        .slider-value {
            font-size: 0.8rem;
            width: 40px;
            text-align: right;
            font-family: monospace;
        }

        /* AI Buttons */
        .ai-powered-button {
            background: linear-gradient(135deg, #4b3cae, #7c4dff);
            border: none;
            color: white;
            font-weight: 500;
        }
        .ai-powered-button:hover {
            background: linear-gradient(135deg, #5c4dd0, #9366ff);
            box-shadow: 0 0 10px rgba(124, 77, 255, 0.4);
        }

        /* Children Nesting */
        .children {
            padding-left: 15px;
            border-left: 2px solid #333;
            margin-left: 5px;
            margin-top: 10px;
        }

        /* --- PREVIEW BAR --- */
        .preview-toolbar {
            background: #252526;
            border-bottom: 1px solid #333;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .device-toggles button {
            background: transparent;
            border: 1px solid transparent;
            color: #888;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 0 2px;
        }
        .device-toggles button:hover, .device-toggles button.active {
            color: #fff;
            background: #3e3e42;
        }

        /* --- GENERAL UTILS --- */
        .modal-content {
            background: #1e1e1e;
            border: 1px solid #444;
            color: #eee;
        }
        .modal-header, .modal-footer {
            border-color: #333;
        }
        .form-select, .form-control {
            background-color: #2a2a2a;
            border-color: #444;
            color: #fff;
        }
        .form-select:focus, .form-control:focus {
            background-color: #2a2a2a;
            border-color: var(--accent-primary);
            color: #fff;
            box-shadow: none;
        }
        
        /* Shorthand toolbar styling */
        .shorthand-toolbar {
            background: #2a2a2a;
            padding: 8px;
            border-radius: 4px 4px 0 0;
            border: 1px solid #444;
            border-bottom: none;
        }
        
        /* Iframe container styling for Merge Tab */
        #merge iframe {
            width: 100%;
            height: 100%;
            min-height: 85vh;
            border: none;
            background: #1e1e1e;
        }

        /* --- CODE EXPLORER & PREVIEW LAYOUT STYLES --- */
        .tab-content#preview {
            display: none; 
            padding: 0 !important; 
            height: 100%;
            overflow: hidden;
            flex-direction: column;
        }
        
        .tab-content#preview.active {
            display: flex !important; 
        }

        .preview-layout-wrapper {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            background: #111; /* Canvas background */
        }

        #preview-top-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
            position: relative;
            align-items: center; /* Center the iframe */
            justify-content: flex-start;
            padding-top: 20px;
        }

        #website-preview {
            background: #fff;
            transition: width 0.3s ease;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        #preview-resizer {
            height: 12px;
            background: #212529;
            cursor: row-resize;
            flex-shrink: 0;
            border-top: 1px solid #444;
            border-bottom: 1px solid #444;
            display: none;
            z-index: 100;
            position: relative;
            align-items: center;
            justify-content: center;
        }
        
        #preview-resizer:hover { background: #0d6efd; }
        #preview-resizer::after {
            content: "••••";
            color: #6c757d;
            font-size: 12px;
            letter-spacing: 2px;
            position: absolute;
            top: -5px; 
        }

        #explorer-panel {
            height: 0;
            background: #1e1e1e;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border-top: 1px solid #333;
            transition: height 0.1s ease-out;
        }
        
        #explorer-panel.active { height: 350px; }

        /* Code Explorer Internal Styles */
        .ce-container { padding: 15px; height: 100%; display: flex; flex-direction: column; font-size: 13px; color: #ccc; }
        .ce-header { display: flex; justify-content: space-between; border-bottom: 1px solid #333; padding-bottom: 8px; margin-bottom: 12px; }
        .ce-header h4 { margin: 0; color: #fff; font-size: 15px; }
        .ce-code-block { background: #1e1e1e; margin-bottom: 20px; }
        .ce-code-content { color: #d4d4d4; background: #1e1e1e; padding: 12px; border: 1px solid #333; border-radius: 4px; font-family: 'Consolas', monospace; }
        
        .ce-search-section { display: flex; gap: 8px; margin-bottom: 15px; }
        .ce-search-input { flex: 1; padding: 6px 10px; border: 1px solid #3c3c3c; background: #252526; color: white; border-radius: 4px; }
        .ce-btn { padding: 6px 14px; background: #0d6efd; color: white; border: none; border-radius: 4px; cursor: pointer; }
        
    </style>
</head>
<body>

    <!-- Login Modal -->
    <div id="auth-modal" class="modal" style="display: block;">
        <div class="modal-content">
            <h2 id="auth-title">Login</h2>
            <div id="auth-error" class="modal-error"></div>
            <div id="login-form">
                <label for="login-username">Username</label>
                <input type="text" id="login-username" autocomplete="username">
                <label for="login-password">Password</label>
                <input type="password" id="login-password" autocomplete="current-password">
                <button id="login-button" class="action-button">Login</button>
                <p>Don't have an account? <a href="#" id="show-signup">Sign Up</a></p>
            </div>
            <div id="signup-form" style="display: none;">
                <label for="signup-username">Username</label>
                <input type="text" id="signup-username" autocomplete="username">
                <label for="signup-password">Password</label>
                <input type="password" id="signup-password" autocomplete="new-password">
                <button id="signup-button" class="action-button">Sign Up</button>
                <p>Already have an account? <a href="#" id="show-login">Login</a></p>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="main-app-container" style="width:100%; height: 100vh; display: none;">
        <div class="container-fluid">
            <div class="row flex-nowrap">
                <!-- Desktop Sidebar -->
                <div class="col-auto px-0 bg-dark d-none d-md-flex">
                    <div class="d-flex flex-column align-items-center pt-2 text-white min-vh-100">
                        <a href="#" class="d-flex align-items-center p-3 text-info text-decoration-none" title="Vibe Coding System">
                           <span class="fs-4" style="font-weight: bold;"></span>
                        </a>
                        <ul class="nav nav-pills flex-column mb-auto text-center" id="menu">
                            <li class="nav-item">
                                <a href="#" class="nav-link py-3 px-2 tab-button active" data-tab="start" title="Start">
                                    <i class="fs-4 bi-house"></i>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="nav-link py-3 px-2 tab-button" data-tab="preview" title="Live Preview">
                                    <i class="fs-4 bi-display"></i>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="nav-link py-3 px-2 tab-button" data-tab="editor" title="Vibe Editor">
                                    <i class="fs-4 bi-pencil-square"></i>
                                </a>
                            </li>
                             <li>
                                <a href="#" class="nav-link py-3 px-2 tab-button" data-tab="agent" title="Agent">
                                    <i class="fs-4 bi-robot"></i>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="nav-link py-3 px-2 tab-button" data-tab="chat" title="Chat">
                                    <i class="fs-4 bi-chat-dots"></i>
                                </a>
                            </li>
                             <li>
                                <a href="#" class="nav-link py-3 px-2 tab-button" data-tab="flowchart" title="Flowchart">
                                    <i class="fs-4 bi-diagram-3"></i>
                                </a>
                            </li>
                             <li>
                                <a href="#" class="nav-link py-3 px-2 tab-button" data-tab="console" title="Console">
                                    <i class="fs-4 bi-terminal"></i><span id="console-error-indicator"></span>
                                </a>
                            </li>
                             <li>
                                <a href="#" class="nav-link py-3 px-2 tab-button" data-tab="files" title="Files">
                                    <i class="fs-4 bi-folder"></i>
                                </a>
                            </li>
                             <li>
                                <a href="#" class="nav-link py-3 px-2 tab-button" data-tab="context" title="Context">
                                    <i class="fs-4 bi-archive"></i>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="nav-link py-3 px-2 tab-button" data-tab="code" title="Full Code">
                                    <i class="fs-4 bi-code-slash"></i>
                                </a>
                            </li>
                            <!-- NEW MERGE TAB BUTTON -->
                            <li>
                                <a href="#" class="nav-link py-3 px-2 tab-button" data-tab="merge" title="Smart Merge">
                                    <i class="fs-4 bi-git"></i>
                                </a>
                            </li>
                        </ul>
                        <div class="dropdown pb-4">
                            <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle p-3" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fs-4 bi-person-circle"></i>
                                <span class="d-none" id="user-status-text">User</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
                                <li><a class="dropdown-item" href="#" id="new-project-button">New project...</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="logout-button">Sign out</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Content Area -->
                <div class="col py-3" style="height: 100vh; overflow: hidden; position: relative;">
                    <div class="main-toolbar d-flex justify-content-end align-items-start" style="position: absolute; right: 20px; top: 10px; z-index: 1000;">
                        <div class="btn-group me-2" role="group" aria-label="Save actions">
                            <button class="btn btn-primary" type="button" id="save-to-cloud-button" disabled title="Save to Cloud (Ctrl/Cmd + S)">
                                <i class="bi bi-cloud-arrow-up"></i>
                            </button>
                            <button class="btn btn-secondary" type="button" id="save-to-local-button" disabled title="Save to Local Storage">
                                <i class="bi bi-hdd"></i>
                            </button>
                            <button class="btn btn-dark" type="button" id="save-to-github-button" disabled title="Save to GitHub">
                                <i class="bi bi-github"></i>
                            </button>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-secondary" type="button" data-bs-toggle="dropdown" aria-expanded="false" title="More options">
                                <i class="bi bi-three-dots-vertical"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                    <button class="dropdown-item" type="button" id="open-ai-structure-modal-button" disabled>
                                        <i class="bi bi-diagram-2 me-2"></i>AI Structure
                                    </button>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <button class="dropdown-item" type="button" id="share-project-button" disabled>
                                        <i class="bi bi-share me-2"></i>Share Project
                                    </button>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <button class="dropdown-item" type="button" id="undo-button">
                                        <i class="bi bi-arrow-counterclockwise me-2"></i>Undo
                                    </button>
                                </li>
                                <li>
                                    <button class="dropdown-item" type="button" id="redo-button">
                                        <i class="bi bi-arrow-clockwise me-2"></i>Redo
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="tab-content-area" style="height: 100%;">
                        <!-- START PAGE -->
                        <div id="start" class="tab-content active">
                             <div class="start-page-content">
                                <div class="start-header d-flex justify-content-between align-items-center">
                                    <h1>Vibe Builder</h1>
                                    <button id="start-page-settings-button" class="settings-button" title="API Settings">⚙️</button>
                                </div>
                                
                                <div class="accordion" id="start-page-accordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingProjects">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseProjects" aria-expanded="true">
                                                Your Projects
                                            </button>
                                        </h2>
                                        <div id="collapseProjects" class="accordion-collapse collapse show" data-bs-parent="#start-page-accordion">
                                            <div class="accordion-body">
                                                <div class="storage-toggle btn-group" role="group">
                                                    <button type="button" class="btn btn-outline-primary active" data-storage="cloud">
                                                        <i class="bi bi-cloud me-1"></i> Cloud
                                                    </button>
                                                    <button type="button" class="btn btn-outline-primary" data-storage="local">
                                                        <i class="bi bi-hdd me-1"></i> Local
                                                    </button>
                                                </div>
                                                <div id="project-list" class="mt-3"></div>
                                                <p id="no-projects-message" style="display: none;">You have no saved projects. Create one below!</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="accordion-item" id="github-load-container" style="display: none;">
                                        <h2 class="accordion-header" id="headingGithub">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGithub">
                                                Load from GitHub
                                            </button>
                                        </h2>
                                        <div id="collapseGithub" class="accordion-collapse collapse" data-bs-parent="#start-page-accordion">
                                            <div class="accordion-body">
                                                <div class="form-group">
                                                    <label for="github-repo-select">Repository</label>
                                                    <select id="github-repo-select" class="form-select"></select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="github-branch-select">Branch</label>
                                                    <select id="github-branch-select" class="form-select"></select>
                                                </div>
                                                <button id="load-from-github-button" class="action-button primary"><i class="bi bi-github me-2"></i>Load Project</button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingNewProject">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNewProject">
                                                Create a New Project
                                            </button>
                                        </h2>
                                        <div id="collapseNewProject" class="accordion-collapse collapse" data-bs-parent="#start-page-accordion">
                                            <div class="accordion-body">
                                                <div id="new-project-container">
                                                    <div class="new-project-form">
                                                        <div class="form-group">
                                                            <label for="new-project-id-input">Project Name</label>
                                                            <input type="text" id="new-project-id-input" placeholder="my-awesome-site">
                                                        </div>
                                                         <div class="form-group">
                                                            <label>Save Location</label>
                                                             <div class="btn-group" role="group">
                                                                 <input type="radio" class="btn-check" name="projectStorage" id="storageCloud" value="cloud" checked>
                                                                 <label class="btn btn-outline-primary" for="storageCloud"><i class="bi bi-cloud me-1"></i> Cloud</label>

                                                                 <input type="radio" class="btn-check" name="projectStorage" id="storageLocal" value="local">
                                                                 <label class="btn btn-outline-primary" for="storageLocal"><i class="bi bi-hdd me-1"></i> Local</label>
                                                             </div>
                                                         </div>
                                                    </div>
                                                    
                                                    <hr class="section-divider">

                                                    <div class="project-creation-method">
                                                        <h3><i class="bi bi-stars"></i> AI Generator</h3>
                                                        <p>Describe your website, and let the AI build it for you.</p>

                                                        <!-- SHORTHAND TOOLBAR -->
                                                        <div class="shorthand-toolbar d-flex gap-2">
                                                            <select id="start-component-shorthand-select" class="form-select form-select-sm" style="flex: 1; background: #1e1e1e; color: #ccc; border-color: #444;">
                                                                <option value="">-- Insert Component Library (@) --</option>
                                                            </select>
                                                            <button id="start-insert-shorthand-button" class="btn btn-sm btn-outline-info">Insert</button>
                                                        </div>

                                                        <textarea id="project-prompt-input" placeholder="e.g., 'A modern portfolio website for a photographer with a gallery and contact form...'"></textarea>
                                                        
                                                        <div class="button-container">
                                                            <button hidden id="generate-project-button" class="action-button primary">Generate Project</button>                                                        
                                                            <button id="start-iterative-build-button" class="action-button agent"><i class="bi bi-rocket-takeoff me-2"></i>Build with Agent</button>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="project-creation-method">
                                                        <h3><i class="bi bi-diagram-3"></i> Structural Generation</h3>
                                                        <p>Define the specific nodes for a boilerplate structure.</p>
                                                        <textarea id="project-instructions-input" placeholder="e.g., 'Header, Hero Section, Features Grid, Footer'"></textarea>
                                                        <div class="button-container">
                                                            <button id="generate-from-instructions-button" class="action-button primary">Generate Structure</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="start-page-generation-output" style="display: none;">
                                    <div id="generation-status-container">
                                        <h3 id="generation-status-text">Generating your project...</h3>
                                        <div class="loading-spinner"></div>
                                    </div>
                                    <div id="live-code-container">
                                        <pre><code id="live-code-output" class="language-html"></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- PREVIEW TAB -->
                        <div id="preview" class="tab-content">
                            <div class="preview-layout-wrapper">
                                <!-- Top Pane: Toolbar + Iframe -->
                                <div id="preview-top-pane">
                                    <div class="preview-toolbar w-100">
                                        <div class="d-flex align-items-center">
                                            <h5 class="m-0 me-3 text-white">Live Preview</h5>
                                            <div class="device-toggles">
                                                <button onclick="document.getElementById('website-preview').style.width='100%'" title="Desktop" class="active"><i class="bi bi-laptop"></i></button>
                                                <button onclick="document.getElementById('website-preview').style.width='768px'" title="Tablet"><i class="bi bi-tablet"></i></button>
                                                <button onclick="document.getElementById('website-preview').style.width='375px'" title="Mobile"><i class="bi bi-phone"></i></button>
                                            </div>
                                        </div>
                                        <button id="code-explorer-toggle-btn" class="btn btn-outline-info btn-sm">
                                            <i class="bi bi-bug me-2"></i>Enable Inspect
                                        </button>
                                    </div>
                                    <iframe id="website-preview" title="Live Website Preview" style="width:100%; height: 100%; border:none; background: #fff;"></iframe>
                                </div>
                                
                                <!-- Resizer Handle -->
                                <div id="preview-resizer"></div>
                                
                                <!-- Bottom Pane: Code Explorer -->
                                <div id="explorer-panel"></div>
                            </div>
                        </div>

                        <!-- EDITOR TAB -->
                        <div id="editor" class="tab-content">
                             <div class="editor-container">
                                <div class="editor-header">
                                    <div class="editor-header-left">
                                        <h2>Visual Editor</h2>
                                        <p>Edit components, properties, and structure.</p>
                                    </div>
                                    <div class="editor-header-right">
                                        <div id="ai-editor-search-container">
                                            <input type="text" id="ai-editor-search-input" placeholder="Search: 'navbar styles'">
                                            <button id="ai-editor-search-button" class="action-button">Find</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- Vibe Editor (JS populates this) -->
                                <div id="vibe-editor"></div>
                            </div>
                        </div>

                        <!-- AGENT TAB -->
                        <div id="agent" class="tab-content">
                             <div class="agent-container">
                                <h2>AI Agent</h2>
                                <p>Queue tasks for the AI to perform sequentially.</p>
                                
                                <div id="agent-controls">
                                    <div class="shorthand-toolbar d-flex gap-2">
                                        <select id="agent-component-shorthand-select" class="form-select form-select-sm" style="flex: 1; background: #1e1e1e; color: #ccc; border-color: #444;">
                                            <option value="">-- Insert Component Library (@) --</option>
                                        </select>
                                        <button id="agent-insert-shorthand-button" class="btn btn-sm btn-outline-info">Insert</button>
                                    </div>

                                    <textarea id="agent-prompt-input" rows="3" placeholder="Describe a task (e.g., 'Create a dark mode toggle')..."></textarea>
                                    
                                    <div class="agent-buttons-container">
                                        <button id="run-agent-single-task-button" class="action-button">Add Task</button>
                                        <button id="start-iterative-session-button" class="action-button primary">Process Queue</button>
                                        <button id="end-session-button" class="action-button danger" style="display: none;">Stop</button>
                                    </div>
                                </div>

                                <div id="agent-output-container">
                                    <h3>Agent Log</h3>
                                    <div id="agent-output">
                                        <div class="agent-message-placeholder">The agent's plan and actions will appear here.</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- OTHER TABS (Chat, Flowchart, Console, etc.) -->
                        <div id="chat" class="tab-content">
                             <div class="chat-container">
                                <h2>Pair Programmer</h2>
                                <div class="system-prompt-container">
                                    <label>System Prompt</label>
                                    <textarea id="chat-system-prompt-input" placeholder="Custom instructions..."></textarea>
                                </div>
                                <div class="chat-output-container">
                                    <div id="chat-output">
                                        <div class="chat-message-placeholder">Start the conversation...</div>
                                    </div>
                                </div>
                                <div class="chat-controls">
                                    <textarea id="chat-prompt-input" placeholder="Ask about your code..."></textarea>
                                    <button id="send-chat-button" class="action-button">Send</button>
                                </div>
                            </div>
                        </div>

                        <div id="flowchart" class="tab-content">
                             <div class="flowchart-container">
                                <h2>Logic Flow</h2>
                                <div class="flowchart-controls">
                                    <button id="generate-flowchart-button" class="action-button">Generate Diagram</button>
                                </div>
                                <div id="flowchart-output">
                                    <div class="flowchart-placeholder">Visualization of project structure.</div>
                                </div>
                            </div>
                        </div>

                        <div id="console" class="tab-content">
                             <div id="console-container">
                                <h2>Console</h2>
                                <div id="console-output"></div>
                            </div>
                        </div>

                        <div id="files" class="tab-content">
                             <div class="files-container">
                                <h2>File Manager</h2>
                                <div class="files-toolbar">
                                    <input type="file" id="files-upload-input" multiple style="display: none;">
                                    <button id="files-upload-button" class="action-button">Upload</button>
                                    <button id="files-new-folder-button" class="action-button">New Folder</button>
                                    <button id="files-new-file-button" class="action-button">New File</button>
                                </div>
                                <div class="files-browser">
                                    <div class="files-tree" id="files-tree"></div>
                                    <div class="files-preview" id="files-preview"></div>
                                </div>
                            </div>
                        </div>

                         <div id="context" class="tab-content">
                             <div class="context-container">
                                <h2>Component Library</h2>
                                <div class="context-browser">
                                    <div class="context-list-panel">
                                        <div id="context-component-list"></div>
                                        <button id="add-new-component-button" class="action-button w-100 mt-2">Add Component</button>
                                        <div class="context-io-buttons mt-2">
                                            <input type="file" id="context-upload-input" style="display: none;">
                                            <button id="upload-context-button" class="action-button small">Import</button>
                                            <button id="download-context-button" class="action-button small">Export</button>
                                        </div>
                                    </div>
                                    <div id="context-component-viewer" class="context-viewer-panel"></div>
                                </div>
                            </div>
                        </div>

                        <div id="code" class="tab-content">
                             <div class="full-code-container">
                                <h2>Full Code</h2>
                                <div class="file-io-section mb-3">
                                    <input type="file" id="html-file-input" accept=".html" style="display: none;">
                                    <button id="upload-html-button" class="action-button small">Upload HTML</button>
                                    <input type="file" id="zip-file-input" accept=".zip" style="display: none;">
                                    <button id="upload-zip-button" class="action-button small">Upload ZIP</button>
                                    <button id="download-zip-button" class="action-button small">Download ZIP</button>
                                </div>
                                <textarea id="full-code-editor" class="form-control" rows="25" style="font-family: 'Roboto Mono', monospace; font-size: 14px; background-color: #1e1e1e; color: #d4d4d4;"></textarea>
                                <div class="full-code-actions mt-2">
                                    <button id="update-tree-from-code-button" class="action-button">
                                        <i class="bi bi-arrow-clockwise"></i> Update Visual Editor from Code
                                    </button>
                                    <div class="ai-prompt-container mt-2">
                                        <input type="text" id="full-code-ai-prompt" placeholder="Describe change to selected code...">
                                        <button id="run-full-code-ai-button" class="action-button ai-powered-button">
                                            <i class="bi bi-stars"></i> AI Edit
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="merge" class="tab-content">
                            <iframe src="https://1stradiant.github.io/vibe/segment.html" title="Smart Merge Tool"></iframe>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation for Mobile -->
    <div class="fixed-bottom bg-dark d-md-none">
        <div class="d-flex justify-content-around">
            <a href="#" class="nav-link py-3 px-2 tab-button active" data-tab="start"><i class="fs-4 bi-house text-white"></i></a>
            <a href="#" class="nav-link py-3 px-2 tab-button" data-tab="preview"><i class="fs-4 bi-display text-white"></i></a>
            <a href="#" class="nav-link py-3 px-2 tab-button" data-tab="editor"><i class="fs-4 bi-pencil-square text-white"></i></a>
            <a href="#" class="nav-link py-3 px-2 tab-button" data-tab="agent"><i class="fs-4 bi-robot text-white"></i></a>
        </div>
    </div>
    
    <!-- MODALS -->

    <!-- Add Node Modal -->
    <div id="add-node-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Add Component</h2>
            <input type="hidden" id="add-node-parent-id">
            <input type="hidden" id="add-node-target-id">
            <input type="hidden" id="add-node-position">
            
            <label>ID</label>
            <input type="text" id="new-node-id" placeholder="e.g., hero-button">
            
            <label>Type</label>
            <select id="new-node-type">
                <option value="html">HTML Element</option>
                <option value="css">CSS Style</option>
                <option value="javascript">JavaScript</option>
            </select>
            
            <label>Description (AI will generate code based on this)</label>
            <textarea id="new-node-description" rows="3" placeholder="e.g., A blue button that says 'Get Started'"></textarea>
            
            <button id="create-node-button" class="action-button primary w-100 mt-2">Create & Generate</button>
            <div id="add-node-error" class="modal-error"></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-settings-modal-button">&times;</span>
            <h2>Settings</h2>
            <div class="mb-3">
                <label>AI Provider</label>
                <select id="ai-provider-select" class="form-select">
                    <option value="gemini">Google Gemini</option>
                    <option value="nscale">nscale</option>
                </select>
            </div>
            
            <div id="gemini-settings-container">
                 <label>Model</label>
                 <select id="gemini-model-select" class="form-select mb-2">
                    <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash</option>
                    <option value="gemini-1.5-pro-latest">Gemini 1.5 Pro</option>
                 </select>
                <div id="gemini-api-key-container">
                    <label>API Key</label>
                    <input type="password" id="api-key-input" placeholder="Gemini API Key">
                    <button id="save-api-key-button" class="action-button mt-1">Save</button>
                    <div id="api-key-status" class="mt-1"></div>
                </div>
            </div>

            <div id="nscale-api-key-container" style="display: none;">
                <label>nscale API Key</label>
                <input type="password" id="nscale-api-key-input">
                <button id="save-nscale-api-key-button" class="action-button mt-1">Save</button>
                <div id="nscale-api-key-status" class="mt-1"></div>
            </div>
            
            <hr>
            
            <div id="github-settings-container">
                <h3>GitHub</h3>
                <label>Personal Access Token</label>
                <input type="password" id="github-pat-input" placeholder="ghp_...">
                <button id="save-github-pat-button" class="action-button mt-1">Connect</button>
                <div id="github-status" class="mt-1"></div>
                <button id="logout-github-button" class="action-button danger mt-2" style="display:none;">Disconnect</button>
            </div>
        </div>
    </div>

    <!-- Edit Node Modal -->
    <div id="edit-node-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close-button" id="close-edit-node-modal-button">&times;</span>
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="m-0">Edit Component</h2>
                <button id="save-as-component-button" class="action-button small">Save to Library</button>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <label>ID</label>
                    <input type="text" id="edit-node-id" readonly class="form-control-plaintext text-white mb-2">
                    
                    <label>AI Description</label>
                    <textarea id="edit-node-description" rows="4"></textarea>
                    <button id="ai-improve-description-button" class="action-button ai-powered-button w-100 mt-2">
                        <i class="bi bi-magic"></i> AI: Refine Description
                    </button>
                </div>
                <div class="col-md-6">
                    <label>Raw Code</label>
                    <textarea id="edit-node-code" rows="8" style="font-family: monospace; font-size: 12px;"></textarea>
                </div>
            </div>

            <div class="mt-3 text-end">
                <button id="save-edit-node-button" class="action-button primary">Save & Update</button>
            </div>
            <div id="edit-node-error" class="modal-error"></div>
        </div>
    </div>

    <!-- AI Controls Modal -->
    <div id="ai-controls-modal" class="modal">
        <div class="modal-content">
            <span id="ai-controls-close-button" class="close-button">&times;</span>
            <h3 id="ai-controls-modal-title">Generate Controls</h3>
            <input type="hidden" id="ai-controls-node-id">
            <p>Describe the UI controls you want (e.g., "Add a color picker for the background and a slider for padding").</p>
            <textarea id="ai-controls-prompt-input" rows="4"></textarea>
            <button id="ai-controls-execute-button" class="action-button ai-powered-button w-100 mt-2">Generate Controls</button>
            <div id="ai-controls-error" class="modal-error"></div>
        </div>
    </div>

    <!-- AI Project Edit Modal -->
    <div id="ai-project-edit-modal" class="modal">
        <div class="modal-content">
            <span id="ai-project-edit-close-button" class="close-button">&times;</span>
            <h2 id="ai-project-edit-modal-title">AI Command</h2>
            <p>Instruct the AI to modify this component or the project.</p>
            <input type="hidden" id="ai-project-edit-node-id">
            <textarea id="ai-project-edit-prompt-input" rows="4" placeholder="e.g., 'Change the background color to dark blue'"></textarea>
            <button id="ai-project-edit-execute-button" class="action-button ai-powered-button w-100 mt-2">Execute</button>
            <p id="ai-project-edit-error" class="modal-error"></p>
        </div>
    </div>
    
    <!-- AI Structure Modal -->
    <div id="ai-structure-modal" class="modal">
        <div class="modal-content">
            <span id="ai-structure-close-button" class="close-button">&times;</span>
            <h2>Refactor Structure</h2>
            <p>Describe how to reorganize the component tree.</p>
            <textarea id="ai-structure-prompt-input" rows="4" placeholder="e.g., 'Move the login button inside the navbar container'"></textarea>
            <button id="ai-structure-execute-button" class="action-button ai-powered-button w-100 mt-2">Update Structure</button>
            <p id="ai-structure-error" class="modal-error"></p>
        </div>
    </div>

    <!-- Context Component Modal -->
    <div id="context-component-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close-button" id="close-context-modal-button">&times;</span>
            <h2 id="component-modal-title">Component</h2>
            
            <div class="component-ai-generator mb-3 p-3" style="background: rgba(138, 43, 226, 0.1); border-radius: 6px;">
                <label>Generate with AI:</label>
                <div class="d-flex gap-2">
                    <textarea id="component-ai-prompt-input" rows="1" class="form-control" placeholder="e.g., 'A responsive card with hover effect'"></textarea>
                    <button id="generate-component-button" class="action-button ai-powered-button">Generate</button>
                </div>
            </div>

            <div class="row g-2">
                <div class="col-md-6">
                    <input type="text" id="component-id-input" placeholder="ID (kebab-case)" class="form-control mb-2">
                    <input type="text" id="component-name-input" placeholder="Display Name" class="form-control mb-2">
                    <textarea id="component-description-input" rows="2" placeholder="Description" class="form-control mb-2"></textarea>
                </div>
                <div class="col-md-6">
                    <div class="nav nav-tabs mb-2" id="comp-tabs" role="tablist">
                        <button class="nav-link active py-1 px-2" data-bs-toggle="tab" data-bs-target="#tab-html" type="button">HTML</button>
                        <button class="nav-link py-1 px-2" data-bs-toggle="tab" data-bs-target="#tab-css" type="button">CSS</button>
                        <button class="nav-link py-1 px-2" data-bs-toggle="tab" data-bs-target="#tab-js" type="button">JS</button>
                    </div>
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="tab-html">
                            <textarea id="component-html-input" rows="6" class="form-control font-monospace"></textarea>
                        </div>
                        <div class="tab-pane fade" id="tab-css">
                            <textarea id="component-css-input" rows="6" class="form-control font-monospace"></textarea>
                        </div>
                        <div class="tab-pane fade" id="tab-js">
                            <textarea id="component-js-input" rows="6" class="form-control font-monospace"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="d-flex justify-content-between mt-3">
                <button id="delete-component-button" class="action-button danger" style="display: none;">Delete</button>
                <button id="save-component-button" class="action-button primary">Save Component</button>
            </div>
            <div id="component-modal-error" class="modal-error"></div>
        </div>
    </div>

    <!-- Global Loader -->
    <div id="global-agent-loader">
        <div class="loading-spinner"></div>
        <div class="loader-text">
            <p id="global-agent-status-text">AI Working...</p>
            <p id="global-agent-progress-text"></p>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="app3.js"></script>
    <script src="automation.js"></script>

    <!-- Code Explorer Logic -->
    <script>
        // (Identical Code Explorer Logic as provided in original file)
        class CodeExplorer {
            constructor(containerId, options = {}) {
                this.container = document.getElementById(containerId);
                if (!this.container) return; 
                this.options = { onEditRequest: options.onEditRequest || null, ...options };
                this.functionRegistry = {}; this.styleRegistry = {};
                this.functionHistory = []; this.historyIndex = -1;
                this._initUI();
            }
            analyze(doc) {
                this.functionRegistry = {}; this.styleRegistry = {};
                Array.from(doc.getElementsByTagName('script')).forEach(s => { if (s.textContent) this._extractFunctions(s.textContent); });
                Array.from(doc.getElementsByTagName('style')).forEach(s => { if (s.textContent) this._extractStyles(s.textContent); });
                this.outputDiv.innerHTML = `<div class="ce-code-block" style="text-align:center;color:#888;margin-top:20px;"><h3><i class="bi bi-search"></i> Ready</h3><p>${Object.keys(this.functionRegistry).length} functions, ${Object.keys(this.styleRegistry).length} styles.</p><p>Click element in preview to inspect.</p></div>`;
            }
            inspectElement(element) {
                this.functionHistory = []; this.historyIndex = -1;
                const content = this._generateElementContent(element);
                this._addToHistory({ type: 'element', name: element.tagName.toLowerCase(), content: content, element: element });
            }
            _initUI() {
                this.container.classList.add('ce-container');
                this.container.innerHTML = `<div class="ce-header"><h4>Inspector</h4><button class="ce-btn-small" id="ce-close-btn"><i class="bi bi-x-lg"></i></button></div><div class="ce-search-section"><input type="text" class="ce-search-input" placeholder="Search functions..."><button class="ce-btn">Search</button></div><div class="ce-results"></div><div class="ce-output"></div>`;
                this.searchInput = this.container.querySelector('.ce-search-input');
                this.searchBtn = this.container.querySelector('.ce-btn');
                this.resultsDiv = this.container.querySelector('.ce-results');
                this.outputDiv = this.container.querySelector('.ce-output');
                this.searchBtn.onclick = () => this._performSearch();
                this.searchInput.onkeyup = (e) => { if(e.key === 'Enter') this._performSearch(); };
                this.container.querySelector('#ce-close-btn').onclick = () => { document.getElementById('code-explorer-toggle-btn').click(); };
            }
            _generateElementContent(element) {
                const tagName = element.tagName.toLowerCase();
                const id = element.id ? `#${element.id}` : '';
                const classes = element.className && typeof element.className === 'string' ? `.${element.className.replace(/\s+/g, '.')}` : '';
                let matchedStyles = '';
                for (const selector in this.styleRegistry) { try { if (element.matches && element.matches(selector)) matchedStyles += `${selector} {\n    ${this.styleRegistry[selector]}\n}\n`; } catch(e){} }
                const relatedFuncs = this._getRelatedFunctions(element);
                return `<div class="ce-code-block"><h3>&lt;${tagName}${id}${classes}&gt;</h3>${this.options.onEditRequest ? `<button class="ce-btn-small" style="float:right;" data-action="edit-el">AI Edit</button>` : ''}<div style="clear:both;"></div><pre class="ce-code-content">${this._escapeHtml(element.outerHTML.split('>')[0] + '> ...')}</pre></div>${matchedStyles ? `<div class="ce-code-block"><h4>CSS</h4><pre class="ce-code-content ce-css-rules">${this._escapeHtml(matchedStyles)}</pre></div>` : ''}${relatedFuncs.length > 0 ? `<div class="ce-code-block"><h4>Events</h4><div class="ce-dependency-tree">${relatedFuncs.map(f => `<span class="ce-function-link" data-fn="${f}">${f}</span>`).join('')}</div></div>` : ''}`;
            }
            _showFunction(name) {
                if (!this.functionRegistry[name]) return;
                const func = this.functionRegistry[name];
                const content = `<div class="ce-code-block"><span class="ce-function-name">${name}()</span><pre class="ce-code-content">${this._linkifyCode(func.code)}</pre>${func.dependencies.length ? `<div class="ce-dependency-tree"><h4>Calls:</h4>${func.dependencies.map(d => `<span class="ce-function-link" data-fn="${d}">${d}</span>`).join('<br>')}</div>` : ''}</div>`;
                this._addToHistory({ type: 'function', name: name, content: content });
            }
            _addToHistory(state) {
                if (this.historyIndex < this.functionHistory.length - 1) this.functionHistory = this.functionHistory.slice(0, this.historyIndex + 1);
                this.functionHistory.push(state); this.historyIndex++; this._renderCurrentState();
            }
            _renderCurrentState() {
                const state = this.functionHistory[this.historyIndex];
                const nav = `<div class="ce-navigation"><button class="ce-btn-small" id="ce-back-btn" ${this.historyIndex === 0 ? 'disabled' : ''}>← Back</button><span style="color:#888;">${state.type.toUpperCase()}: ${state.name}</span></div>`;
                this.outputDiv.innerHTML = nav + state.content; this.resultsDiv.innerHTML = ''; 
                this.outputDiv.querySelector('#ce-back-btn').onclick = () => { if (this.historyIndex > 0) { this.historyIndex--; this._renderCurrentState(); } };
                this.outputDiv.querySelectorAll('.ce-function-link').forEach(el => { el.onclick = () => this._showFunction(el.dataset.fn); });
                this.outputDiv.querySelectorAll('button[data-action="edit-el"]').forEach(btn => {
                    btn.onclick = () => {
                       const prompt = document.getElementById('ai-project-edit-prompt-input'); 
                       if(prompt) { prompt.value = `Focusing on <${state.name}> element... `; document.getElementById('ai-project-edit-modal').style.display = 'block'; }
                    };
                });
            }
            _extractFunctions(code) { const r = /function\s+(\w+)\s*\([^)]*\)\s*{/g; let m; while ((m = r.exec(code)) !== null) { const b = this._extractCodeBlock(code, code.indexOf('{', m.index)); if(b) this.functionRegistry[m[1]] = { code: b, dependencies: this._findDependencies(b) }; } }
            _extractStyles(css) { const r = /([^{]+)\{([^}]+)\}/g; let m; while ((m = r.exec(css)) !== null) { this.styleRegistry[m[1].trim()] = m[2].trim(); } }
            _extractCodeBlock(code, openIndex) { if (openIndex < 0) return null; let count = 1, i = openIndex + 1; while (count > 0 && i < code.length) { if (code[i] === '{') count++; else if (code[i] === '}') count--; i++; } return code.substring(openIndex, i + 1); }
            _findDependencies(body) { return Object.keys(this.functionRegistry).filter(name => body.includes(name + '(')); }
            _getRelatedFunctions(element) { const funcs = []; if (element.attributes) { Array.from(element.attributes).forEach(attr => { if (attr.name.startsWith('on')) { const val = attr.value.split('(')[0]; if(this.functionRegistry[val]) funcs.push(val); } }); } return funcs; }
            _performSearch() { const term = this.searchInput.value.toLowerCase(); if (!term) return; let html = ''; Object.keys(this.functionRegistry).forEach(name => { if (name.toLowerCase().includes(term)) { html += `<div class="ce-search-result" data-fn="${name}"><span class="ce-result-type">FN</span> ${name}</div>`; } }); this.resultsDiv.innerHTML = html || '<div style="padding:5px;">No results</div>'; this.resultsDiv.querySelectorAll('.ce-search-result').forEach(el => el.onclick = () => this._showFunction(el.dataset.fn)); }
            _linkifyCode(code) { return this._escapeHtml(code); }
            _escapeHtml(str) { return str.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;"); }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const previewIframe = document.getElementById('website-preview');
            const inspectBtn = document.getElementById('code-explorer-toggle-btn');
            const explorerPanel = document.getElementById('explorer-panel');
            const resizer = document.getElementById('preview-resizer');
            const topPane = document.getElementById('preview-top-pane');
            let explorer = null; let isInspectActive = false;

            explorer = new CodeExplorer('explorer-panel', { onEditRequest: (type, name) => console.log("Edit req", type, name) });

            const setupIframeInteraction = (iframe) => {
                if (!isInspectActive) return;
                try {
                    const doc = iframe.contentDocument; if (!doc) return;
                    if (doc.hasAttachedVibeInspect) return; doc.hasAttachedVibeInspect = true;
                    if(!doc.getElementById('ce-injected-styles')) { const s = doc.createElement('style'); s.id = 'ce-injected-styles'; s.textContent = `.ce-highlight { outline: 3px solid #0d6efd !important; cursor: pointer !important; z-index: 2147483647; } body { cursor: default; }`; doc.head.appendChild(s); }
                    explorer.analyze(doc);
                    doc.addEventListener('click', (e) => {
                        if (!isInspectActive) return; e.preventDefault(); e.stopPropagation();
                        const prev = doc.querySelector('.ce-highlight'); if(prev) prev.classList.remove('ce-highlight');
                        let target = e.target; if (target.tagName === 'HTML') target = doc.body; target.classList.add('ce-highlight');
                        explorer.inspectElement(target);
                    }, true);
                    doc.addEventListener('mouseover', (e) => { if (!isInspectActive) return; e.stopPropagation(); e.target.style.cursor = 'crosshair'; }, true);
                } catch (err) { console.warn("Vibe Code Explorer: Cross-origin restriction.", err); }
            };

            inspectBtn.addEventListener('click', () => {
                isInspectActive = !isInspectActive;
                if (isInspectActive) {
                    inspectBtn.classList.remove('btn-outline-info'); inspectBtn.classList.add('btn-info');
                    resizer.style.display = 'flex'; explorerPanel.classList.add('active');
                    setupIframeInteraction(previewIframe);
                } else {
                    inspectBtn.classList.add('btn-outline-info'); inspectBtn.classList.remove('btn-info');
                    resizer.style.display = 'none'; explorerPanel.classList.remove('active');
                    try { const doc = previewIframe.contentDocument; if(doc && doc.querySelector('.ce-highlight')) doc.querySelector('.ce-highlight').classList.remove('ce-highlight'); } catch(e) {}
                }
            });

            previewIframe.addEventListener('load', () => { if (isInspectActive) setupIframeInteraction(previewIframe); });

            let isResizing = false;
            resizer.addEventListener('mousedown', () => { isResizing = true; topPane.style.pointerEvents = 'none'; document.body.style.cursor = 'row-resize'; });
            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                const containerRect = document.querySelector('.preview-layout-wrapper').getBoundingClientRect();
                const newHeight = containerRect.bottom - e.clientY;
                if (newHeight > 50 && newHeight < containerRect.height - 100) explorerPanel.style.height = `${newHeight}px`;
            });
            document.addEventListener('mouseup', () => { if (isResizing) { isResizing = false; topPane.style.pointerEvents = 'auto'; document.body.style.cursor = 'default'; } });
        });
    </script>
</body>
</html>