
<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibe Coding System</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

    <style>
        :root {
            --bg-app: #0f172a;
            --bg-panel: #1e293b;
            --bg-input: #334155;
            --border-color: #334155;
            --accent-primary: #8b5cf6; /* Violet */
            --accent-secondary: #6366f1; /* Indigo */
            --accent-hover: #7c3aed;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --danger: #ef4444;
            --success: #10b981;
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --font-ui: 'Inter', sans-serif;
            --font-code: 'JetBrains Mono', 'Roboto Mono', monospace;
        }

        body {
            background-color: var(--bg-app);
            color: var(--text-main);
            font-family: var(--font-ui);
            overflow: hidden; /* App-like feel */
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-app);
        }
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Sidebar Styling */
        .sidebar-container {
            background-color: var(--bg-panel);
            border-right: 1px solid var(--border-color);
            width: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 100;
        }

        .nav-link.tab-button {
            color: var(--text-muted);
            border-radius: var(--radius-md);
            margin: 4px 0;
            transition: all 0.2s ease;
            position: relative;
        }

        .nav-link.tab-button:hover {
            color: var(--text-main);
            background-color: rgba(255, 255, 255, 0.05);
        }

        .nav-link.tab-button.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        /* Main Content Area */
        .tab-content-area {
            height: calc(100vh - 60px);
            overflow-y: auto;
            position: relative;
            background: var(--bg-app);
        }

        .tab-content {
            display: none;
            height: 100%;
            padding: 20px;
            animation: fadeIn 0.2s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Typography & Headings */
        h1, h2, h3, h4 {
            font-weight: 600;
            letter-spacing: -0.5px;
            color: white;
        }

        /* Buttons */
        .action-button, .btn-primary, .btn-secondary, .btn-dark {
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            font-weight: 500;
            transition: transform 0.1s, box-shadow 0.2s;
        }

        .action-button {
            background-color: var(--bg-input);
            color: var(--text-main);
            border: 1px solid var(--border-color);
        }
        
        .action-button:hover {
            background-color: #475569;
            color: white;
        }

        .action-button.primary, .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
        }
        
        .action-button.primary:hover, .btn-primary:hover {
            background: linear-gradient(135deg, var(--accent-hover), var(--accent-secondary));
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.4);
        }

        .action-button.danger {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .action-button.danger:hover {
            background-color: var(--danger);
            color: white;
        }

        /* Inputs & Textareas */
        input[type="text"], input[type="password"], textarea, select, .form-control, .form-select {
            background-color: var(--bg-input) !important;
            border: 1px solid transparent !important;
            color: var(--text-main) !important;
            border-radius: var(--radius-sm);
            padding: 10px;
        }

        input:focus, textarea:focus, select:focus, .form-control:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--accent-primary) !important;
            border-color: var(--accent-primary) !important;
        }

        /* Start Page Specifics */
        .start-page-content {
            max-width: 1000px;
            margin: 0 auto;
        }

        .accordion-item {
            background-color: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            margin-bottom: 15px;
            overflow: hidden;
        }

        .accordion-button {
            background-color: var(--bg-panel);
            color: var(--text-main);
            font-weight: 600;
            box-shadow: none !important;
        }

        .accordion-button:not(.collapsed) {
            background-color: rgba(139, 92, 246, 0.1);
            color: var(--accent-primary);
        }

        .accordion-body {
            background-color: rgba(15, 23, 42, 0.5);
        }

        /* Cards on Start Page */
        .project-card {
            background: var(--bg-input);
            padding: 15px;
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid transparent;
        }
        .project-card:hover {
            border-color: var(--accent-primary);
        }

        /* Modals */
        .modal {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            color: var(--text-main);
        }

        .modal-header, .modal-footer {
            border-color: var(--border-color);
        }

        /* Editor Areas */
        #website-preview {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            border-radius: var(--radius-sm);
        }

        #full-code-editor, #vibe-editor {
            font-family: var(--font-code);
            background-color: #0d1117;
            color: #c9d1d9;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            width: 100%;
            min-height: 500px;
        }

        /* Toolbar */
        .main-toolbar {
            padding: 10px 20px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-app);
            margin-bottom: 0;
        }

        /* Agent & Chat */
        .chat-container, .agent-container {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        #chat-output, #agent-output {
            flex-grow: 1;
            background: var(--bg-panel);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 15px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        .user-msg {
            background: var(--accent-primary);
            color: white;
            padding: 10px 15px;
            border-radius: 15px 15px 0 15px;
            align-self: flex-end;
            margin: 5px 0;
            max-width: 80%;
        }

        .ai-msg {
            background: var(--bg-input);
            padding: 10px 15px;
            border-radius: 15px 15px 15px 0;
            align-self: flex-start;
            margin: 5px 0;
            max-width: 80%;
        }
        
        /* File Tree */
        .files-tree {
            font-family: var(--font-code);
            font-size: 0.9rem;
        }
        
        /* Labels */
        label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 5px;
            margin-top: 10px;
            display: block;
        }

        /* Utilities */
        .text-info { color: var(--accent-secondary) !important; }
        
        /* Close Button */
        .close-button {
            color: var(--text-muted);
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
        }
        .close-button:hover { color: white; }

        .dropdown-menu-dark {
            background-color: var(--bg-panel);
            border: 1px solid var(--border-color);
        }
        
        /* Code Block in Start Page */
        #live-code-container {
            background: #0d1117;
            padding: 15px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
            margin-top: 15px;
        }
        #live-code-output {
            font-family: var(--font-code);
            color: #7ee787;
        }

    </style>
</head>
<body>

    <!-- Login Modal -->
    <div id="auth-modal" class="modal" style="display: block;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content p-4">
                <div class="text-center mb-4">
                    <h2 id="auth-title" class="fw-bold text-white">Login</h2>
                    <p class="text-muted">Welcome back to Vibe</p>
                </div>
                <div id="auth-error" class="alert alert-danger d-none"></div>
                
                <div id="login-form">
                    <div class="mb-3">
                        <label for="login-username">Username</label>
                        <input type="text" id="login-username" class="form-control" autocomplete="username">
                    </div>
                    <div class="mb-4">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-control" autocomplete="current-password">
                    </div>
                    <button id="login-button" class="btn btn-primary w-100 py-2">Login</button>
                    <p class="mt-3 text-center text-muted text-small">Don't have an account? <a href="#" id="show-signup" class="text-info text-decoration-none">Sign Up</a></p>
                </div>

                <div id="signup-form" style="display: none;">
                    <div class="mb-3">
                        <label for="signup-username">Username</label>
                        <input type="text" id="signup-username" class="form-control" autocomplete="username">
                    </div>
                    <div class="mb-4">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" class="form-control" autocomplete="new-password">
                    </div>
                    <button id="signup-button" class="btn btn-primary w-100 py-2">Sign Up</button>
                    <p class="mt-3 text-center text-muted text-small">Already have an account? <a href="#" id="show-login" class="text-info text-decoration-none">Login</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="main-app-container" style="width:100%; height: 100vh; display: none;">
        <div class="container-fluid h-100 p-0">
            <div class="d-flex h-100">
                <!-- Desktop Sidebar -->
                <div class="sidebar-container d-none d-md-flex py-3">
                    <a href="#" class="mb-4 text-decoration-none" title="Vibe Coding System">
                       <i class="bi bi-cpu fs-2" style="color: var(--accent-primary);"></i>
                    </a>
                    <ul class="nav flex-column mb-auto text-center w-100 px-2" id="menu">
                        <li class="nav-item w-100">
                            <a href="#" class="nav-link tab-button active" data-tab="start" title="Start">
                                <i class="fs-5 bi-house-door"></i>
                            </a>
                        </li>
                        <li class="nav-item w-100">
                            <a href="#" class="nav-link tab-button" data-tab="preview" title="Live Preview">
                                <i class="fs-5 bi-play-circle"></i>
                            </a>
                        </li>
                        <li class="nav-item w-100">
                            <a href="#" class="nav-link tab-button" data-tab="editor" title="Vibe Editor">
                                <i class="fs-5 bi-pencil-square"></i>
                            </a>
                        </li>
                         <li class="nav-item w-100">
                            <a href="#" class="nav-link tab-button" data-tab="agent" title="Agent">
                                <i class="fs-5 bi-robot"></i>
                            </a>
                        </li>
                        <li class="nav-item w-100">
                            <a href="#" class="nav-link tab-button" data-tab="chat" title="Chat">
                                <i class="fs-5 bi-chat-left-text"></i>
                            </a>
                        </li>
                         <li class="nav-item w-100">
                            <a href="#" class="nav-link tab-button" data-tab="flowchart" title="Flowchart">
                                <i class="fs-5 bi-diagram-3"></i>
                            </a>
                        </li>
                         <li class="nav-item w-100">
                            <a href="#" class="nav-link tab-button" data-tab="console" title="Console">
                                <i class="fs-5 bi-terminal"></i><span id="console-error-indicator"></span>
                            </a>
                        </li>
                         <li class="nav-item w-100">
                            <a href="#" class="nav-link tab-button" data-tab="files" title="Files">
                                <i class="fs-5 bi-folder2-open"></i>
                            </a>
                        </li>
                         <li class="nav-item w-100">
                            <a href="#" class="nav-link tab-button" data-tab="context" title="Context">
                                <i class="fs-5 bi-box-seam"></i>
                            </a>
                        </li>
                        <li class="nav-item w-100">
                            <a href="#" class="nav-link tab-button" data-tab="code" title="Full Code">
                                <i class="fs-5 bi-code-slash"></i>
                            </a>
                        </li>
                    </ul>
                    <div class="dropdown pb-2">
                        <a href="#" class="d-flex align-items-center justify-content-center text-white text-decoration-none dropdown-toggle p-2" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
                            <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="bi bi-person-fill"></i>
                            </div>
                            <span class="d-none" id="user-status-text">User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
                            <li><a class="dropdown-item" href="#" id="new-project-button"><i class="bi bi-plus-circle me-2"></i>New project...</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" id="logout-button"><i class="bi bi-box-arrow-right me-2"></i>Sign out</a></li>
                        </ul>
                    </div>
                </div>

                <!-- Content Area -->
                <div class="col h-100 d-flex flex-column p-0">
                    <!-- Main Toolbar -->
                    <div class="main-toolbar d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <h5 class="m-0 fw-bold text-white me-3">Vibe <span class="badge bg-primary rounded-pill" style="font-size: 0.6rem; vertical-align: top;">BETA</span></h5>
                        </div>
                        
                        <div class="d-flex align-items-center">
                            <div class="btn-group me-3" role="group" aria-label="Save actions">
                                <button class="btn btn-outline-secondary border-0" type="button" id="save-to-cloud-button" disabled title="Save to Cloud (Ctrl/Cmd + S)">
                                    <i class="bi bi-cloud-arrow-up fs-5"></i>
                                </button>
                                <button class="btn btn-outline-secondary border-0" type="button" id="save-to-local-button" disabled title="Save to Local Storage">
                                    <i class="bi bi-hdd fs-5"></i>
                                </button>
                                <button class="btn btn-outline-secondary border-0" type="button" id="save-to-github-button" disabled title="Save to GitHub">
                                    <i class="bi bi-github fs-5"></i>
                                </button>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-link text-white p-0" type="button" data-bs-toggle="dropdown" aria-expanded="false" title="More options">
                                    <i class="bi bi-three-dots-vertical fs-5"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark shadow-lg border-0">
                                    <li>
                                        <button class="dropdown-item" type="button" id="open-ai-structure-modal-button" disabled>
                                            <i class="bi bi-diagram-2 me-2 text-info"></i>AI Structure
                                        </button>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <button class="dropdown-item" type="button" id="share-project-button" disabled>
                                            <i class="bi bi-share me-2"></i>Share Project
                                        </button>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <button class="dropdown-item" type="button" id="undo-button">
                                            <i class="bi bi-arrow-counterclockwise me-2"></i>Undo
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item" type="button" id="redo-button">
                                            <i class="bi bi-arrow-clockwise me-2"></i>Redo
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Dynamic Tabs -->
                    <div class="tab-content-area col">
                        <div id="start" class="tab-content active">
                             <div class="start-page-content py-4">
                                <div class="d-flex justify-content-between align-items-center mb-5">
                                    <div>
                                        <h1 class="display-6 fw-bold mb-1">Welcome Back</h1>
                                        <p class="text-muted">What will you build today?</p>
                                    </div>
                                    <button id="start-page-settings-button" class="btn btn-outline-secondary rounded-circle p-2" title="API Settings">
                                        <i class="bi bi-gear-fill"></i>
                                    </button>
                                </div>
                                
                                <div class="accordion" id="start-page-accordion">
                                    <!-- Projects Section -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingProjects">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseProjects" aria-expanded="true">
                                                <i class="bi bi-folder2 me-2"></i> Your Projects
                                            </button>
                                        </h2>
                                        <div id="collapseProjects" class="accordion-collapse collapse show" data-bs-parent="#start-page-accordion">
                                            <div class="accordion-body">
                                                <div class="d-flex justify-content-between align-items-center mb-3">
                                                    <div class="storage-toggle btn-group" role="group">
                                                        <button type="button" class="btn btn-sm btn-outline-primary active" data-storage="cloud">
                                                            <i class="bi bi-cloud me-1"></i> Cloud
                                                        </button>
                                                        <button type="button" class="btn btn-sm btn-outline-primary" data-storage="local">
                                                            <i class="bi bi-hdd me-1"></i> Local
                                                        </button>
                                                    </div>
                                                </div>
                                                <div id="project-list" class="d-flex flex-column gap-2"></div>
                                                <div id="no-projects-message" class="text-center py-4 text-muted" style="display: none;">
                                                    <i class="bi bi-journal-x fs-3 d-block mb-2"></i>
                                                    You have no saved projects here.
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- GitHub Section -->
                                    <div class="accordion-item" id="github-load-container" style="display: none;">
                                        <h2 class="accordion-header" id="headingGithub">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGithub">
                                                <i class="bi bi-github me-2"></i> Load from GitHub
                                            </button>
                                        </h2>
                                        <div id="collapseGithub" class="accordion-collapse collapse" data-bs-parent="#start-page-accordion">
                                            <div class="accordion-body">
                                                <div class="row g-3">
                                                    <div class="col-md-6">
                                                        <label for="github-repo-select">Repository</label>
                                                        <select id="github-repo-select" class="form-select">
                                                            <option>-- Connect in Settings --</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="github-branch-select">Branch</label>
                                                        <select id="github-branch-select" class="form-select">
                                                            <option>-- Select Repo First --</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-12">
                                                        <button id="load-from-github-button" class="btn btn-primary w-100"><i class="bi bi-download me-2"></i>Load Project</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- New Project Section -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingNewProject">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNewProject">
                                                <i class="bi bi-plus-square me-2"></i> Create New Project
                                            </button>
                                        </h2>
                                        <div id="collapseNewProject" class="accordion-collapse collapse" data-bs-parent="#start-page-accordion">
                                            <div class="accordion-body">
                                                <div class="row g-4">
                                                    <div class="col-md-6">
                                                        <h5 class="mb-3 text-white">Project Details</h5>
                                                        <div class="mb-3">
                                                            <label for="new-project-id-input">Project Name</label>
                                                            <input type="text" id="new-project-id-input" placeholder="my-awesome-new-site">
                                                        </div>
                                                         <div class="mb-3">
                                                            <label class="mb-2">Save Location</label>
                                                             <div class="btn-group w-100" role="group">
                                                                 <input type="radio" class="btn-check" name="projectStorage" id="storageCloud" value="cloud" autocomplete="off" checked>
                                                                 <label class="btn btn-outline-primary" for="storageCloud"><i class="bi bi-cloud me-1"></i> Cloud</label>

                                                                 <input type="radio" class="btn-check" name="projectStorage" id="storageLocal" value="local" autocomplete="off">
                                                                 <label class="btn btn-outline-primary" for="storageLocal"><i class="bi bi-hdd me-1"></i> Local</label>
                                                             </div>
                                                         </div>
                                                    </div>
                                                    
                                                    <div class="col-md-6 border-start border-secondary ps-md-4">
                                                        <h5 class="mb-3 text-white">Generation Method</h5>
                                                        
                                                        <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                                                          <li class="nav-item" role="presentation">
                                                            <button class="nav-link active btn-sm" id="pills-goal-tab" data-bs-toggle="pill" data-bs-target="#pills-goal" type="button">Natural Language</button>
                                                          </li>
                                                          <li class="nav-item" role="presentation">
                                                            <button class="nav-link btn-sm" id="pills-struct-tab" data-bs-toggle="pill" data-bs-target="#pills-struct" type="button">Structural</button>
                                                          </li>
                                                        </ul>
                                                        
                                                        <div class="tab-content" id="pills-tabContent">
                                                          <div class="tab-pane fade show active" id="pills-goal" role="tabpanel">
                                                              <p class="text-muted small">Describe your website concept.</p>
                                                              <textarea id="project-prompt-input" class="form-control mb-3" rows="3" placeholder="e.g., 'A portfolio for a photographer with a gallery and contact form'"></textarea>
                                                              <button hidden id="generate-project-button"></button>                                                        
                                                              <button id="start-iterative-build-button" class="btn btn-primary w-100"><i class="bi bi-stars me-2"></i>Build with AI Agent</button>
                                                          </div>
                                                          
                                                          <div class="tab-pane fade" id="pills-struct" role="tabpanel">
                                                              <p class="text-muted small">Define technical node structure.</p>
                                                              <textarea id="project-instructions-input" class="form-control mb-3" rows="3" placeholder="e.g., 'Header, Main(Hero, Features), Footer'"></textarea>
                                                              <button id="generate-from-instructions-button" class="btn btn-primary w-100"><i class="bi bi-diagram-2 me-2"></i>Generate Structure</button>
                                                          </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="start-page-generation-output" style="display: none;" class="mt-4">
                                    <div id="generation-status-container" class="text-center mb-3">
                                        <div class="spinner-border text-primary mb-2" role="status"></div>
                                        <h4 id="generation-status-text" class="text-white">Crafting your project...</h4>
                                    </div>
                                    <div id="live-code-container">
                                        <pre><code id="live-code-output" class="language-html"></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                         <div id="preview" class="tab-content h-100 p-0">
                            <div class="d-flex flex-column h-100">
                                <div class="bg-dark p-2 d-flex justify-content-between align-items-center border-bottom border-secondary">
                                    <span class="text-muted small ps-2">Live Preview</span>
                                    <button id="toggle-inspect-button" class="btn btn-sm btn-outline-info" title="Click to select elements in the preview"><i class="bi bi-crosshair"></i> Inspect</button>
                                </div>
                                <iframe id="website-preview" title="Live Website Preview"></iframe>
                            </div>
                        </div>

                        <div id="editor" class="tab-content">
                            <div class="editor-container h-100 d-flex flex-column">
                                <div class="editor-header d-flex justify-content-between align-items-center mb-3">
                                    <div>
                                        <h3 class="mb-1">Visual Editor</h3>
                                        <p class="text-muted small mb-0">Edit descriptions to update the UI tree.</p>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <div id="ai-editor-search-container" class="d-flex gap-2">
                                            <input type="text" id="ai-editor-search-input" placeholder="AI Search..." style="width: 250px;">
                                            <button id="ai-editor-search-button" class="action-button">Find</button>
                                        </div>
                                    </div>
                                </div>
                                <div id="vibe-editor" class="flex-grow-1"></div>
                            </div>
                        </div>
                        
                        <div id="agent" class="tab-content">
                            <div class="agent-container h-100">
                                <h3 class="mb-3">AI Agent Queue</h3>
                                <div id="agent-output-container" class="flex-grow-1 d-flex flex-column" style="min-height: 0;">
                                    <div id="agent-output" class="flex-grow-1">
                                        <div class="text-muted text-center mt-5">Tasks and plans will appear here.</div>
                                    </div>
                                </div>
                                
                                <div id="agent-controls" class="mt-3 pt-3 border-top border-secondary">
                                    <textarea id="agent-prompt-input" class="form-control mb-2" rows="2" placeholder="Describe a task (e.g., 'Refactor the CSS to be mobile-first')..."></textarea>
                                    <div class="d-flex gap-2">
                                        <button id="run-agent-single-task-button" class="action-button"><i class="bi bi-plus-lg"></i> Add Task</button>
                                        <button id="start-iterative-session-button" class="action-button primary"><i class="bi bi-play-fill"></i> Process Queue</button>
                                        <button id="end-session-button" class="action-button danger" style="display: none;"><i class="bi bi-stop-fill"></i> Stop</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="chat" class="tab-content">
                            <div class="chat-container h-100">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h3>Project Chat</h3>
                                </div>
                                <div class="system-prompt-container mb-3 collapse" id="systemPromptCollapse">
                                    <label class="small">System Persona</label>
                                    <textarea id="chat-system-prompt-input" class="form-control form-control-sm" rows="2" placeholder="e.g., You are a React expert..."></textarea>
                                </div>
                                <div class="chat-output-container flex-grow-1 d-flex flex-column" style="min-height: 0;">
                                    <div id="chat-output" class="flex-grow-1">
                                        <div class="text-center text-muted mt-5">
                                            <i class="bi bi-chat-dots fs-1 mb-2"></i>
                                            <p>Ask questions about your codebase.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="chat-controls mt-3 d-flex gap-2">
                                    <textarea id="chat-prompt-input" class="form-control" rows="1" placeholder="Type your message..."></textarea>
                                    <button id="send-chat-button" class="action-button primary px-4"><i class="bi bi-send-fill"></i></button>
                                </div>
                            </div>
                        </div>

                        <div id="flowchart" class="tab-content">
                            <div class="flowchart-container h-100 d-flex flex-column">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h3>Logic Flow</h3>
                                    <button id="generate-flowchart-button" class="action-button primary"><i class="bi bi-arrow-repeat"></i> Generate Graph</button>
                                </div>
                                <div id="flowchart-output" class="flex-grow-1 bg-dark rounded border border-secondary d-flex align-items-center justify-content-center">
                                    <div class="text-muted">Click "Generate" to visualize logic.</div>
                                </div>
                            </div>
                        </div>

                        <div id="console" class="tab-content">
                            <div id="console-container" class="h-100 d-flex flex-column">
                                <h3>System Console</h3>
                                <div id="console-output" class="flex-grow-1 bg-black rounded p-3 font-monospace text-success overflow-auto border border-secondary">
                                    <span class="text-muted">// System ready...</span><br>
                                </div>
                            </div>
                        </div>

                        <div id="files" class="tab-content">
                            <div class="files-container h-100 d-flex flex-column">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h3>Asset Manager</h3>
                                    <div class="d-flex gap-1">
                                        <input type="file" id="files-upload-input" multiple style="display: none;">
                                        <button id="files-upload-button" class="btn btn-sm btn-primary"><i class="bi bi-upload"></i></button>
                                        <button id="files-new-folder-button" class="btn btn-sm btn-secondary"><i class="bi bi-folder-plus"></i></button>
                                        <button id="files-delete-button" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i></button>
                                    </div>
                                </div>
                                <div class="row h-100 g-3">
                                    <div class="col-md-4 h-100">
                                        <div class="files-tree h-100 bg-dark rounded p-2 border border-secondary overflow-auto" id="files-tree"></div>
                                    </div>
                                    <div class="col-md-8 h-100">
                                        <div class="files-preview h-100 bg-dark rounded border border-secondary d-flex align-items-center justify-content-center" id="files-preview">
                                            <span class="text-muted">Select a file to preview</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                         <div id="context" class="tab-content">
                            <div class="context-container h-100 d-flex flex-column">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h3>Component Library</h3>
                                    <button id="add-new-component-button" class="action-button primary">New Component</button>
                                </div>
                                <div class="row h-100 g-3">
                                    <div class="col-md-4 h-100 d-flex flex-column">
                                        <div id="context-component-list" class="flex-grow-1 bg-dark rounded p-2 border border-secondary overflow-auto mb-2"></div>
                                        <div class="btn-group w-100">
                                            <input type="file" id="context-upload-input" accept=".json,application/json" style="display: none;">
                                            <button id="upload-context-button" class="btn btn-sm btn-outline-secondary">Import</button>
                                            <button id="download-context-button" class="btn btn-sm btn-outline-secondary">Export</button>
                                        </div>
                                    </div>
                                    <div class="col-md-8 h-100">
                                        <div id="context-component-viewer" class="h-100 bg-dark rounded border border-secondary p-3 overflow-auto">
                                            <span class="text-muted">Select a component...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="code" class="tab-content">
                            <div class="full-code-container h-100 d-flex flex-column">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h3>Source Code</h3>
                                    <div class="btn-group">
                                        <input type="file" id="html-file-input" accept=".html,text/html" style="display: none;">
                                        <button id="upload-html-button" class="btn btn-sm btn-outline-secondary" title="Upload HTML"><i class="bi bi-filetype-html"></i></button>
                                        <button id="download-zip-button" class="btn btn-sm btn-outline-secondary" title="Download ZIP"><i class="bi bi-file-zip"></i></button>
                                    </div>
                                </div>
                                
                                <div class="input-group mb-2">
                                    <span class="input-group-text bg-dark border-secondary text-white"><i class="bi bi-search"></i></span>
                                    <input type="text" id="search-input" class="form-control bg-dark border-secondary text-white" placeholder="Find in code...">
                                    <button id="find-prev-button" class="btn btn-outline-secondary"><i class="bi bi-chevron-up"></i></button>
                                    <button id="find-next-button" class="btn btn-outline-secondary"><i class="bi bi-chevron-down"></i></button>
                                </div>

                                <textarea id="full-code-editor" class="flex-grow-1 mb-2"></textarea>
                                
                                <div class="full-code-actions bg-dark p-2 rounded border border-secondary d-flex gap-2 align-items-center">
                                    <button id="update-tree-from-code-button" class="btn btn-secondary btn-sm">
                                        <i class="bi bi-arrow-clockwise"></i> Sync Tree
                                    </button>
                                    <div class="d-flex flex-grow-1 gap-2">
                                        <input type="text" id="full-code-ai-prompt" class="form-control form-control-sm" placeholder="AI Edit: 'Add a dark mode toggle'"/>
                                        <button id="run-full-code-ai-button" class="btn btn-primary btn-sm">
                                            <i class="bi bi-stars"></i> Apply
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation for Mobile -->
    <div class="fixed-bottom bg-dark border-top border-secondary d-md-none">
        <div class="d-flex justify-content-around py-2">
            <a href="#" class="nav-link p-2 tab-button active" data-tab="start"><i class="fs-4 bi-house"></i></a>
            <a href="#" class="nav-link p-2 tab-button" data-tab="preview"><i class="fs-4 bi-play"></i></a>
            <a href="#" class="nav-link p-2 tab-button" data-tab="editor"><i class="fs-4 bi-pencil"></i></a>
            <a href="#" class="nav-link p-2 tab-button" data-tab="agent"><i class="fs-4 bi-robot"></i></a>
            <a href="#" class="nav-link p-2 tab-button" data-tab="code"><i class="fs-4 bi-code"></i></a>
        </div>
    </div>
    
    <!-- Modals (Styled via CSS above) -->
    
    <!-- Add Node Modal -->
     <div id="add-node-modal" class="modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Component</h5>
                    <button type="button" class="btn-close btn-close-white close-button"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="add-node-parent-id">
                    <input type="hidden" id="add-node-target-id">
                    <input type="hidden" id="add-node-position">
                    
                    <div class="mb-3">
                        <label for="new-node-id">ID (kebab-case)</label>
                        <input type="text" id="new-node-id" placeholder="my-new-button">
                    </div>
                    <div class="mb-3">
                        <label for="new-node-type">Type</label>
                        <select id="new-node-type" class="form-select">
                            <option value="html">HTML Element</option>
                            <option value="css">CSS Style</option>
                            <option value="javascript">JavaScript Logic</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="new-node-description">Description</label>
                        <textarea id="new-node-description" rows="3" placeholder="Describe what this component does..."></textarea>
                    </div>
                    <div id="add-node-error" class="text-danger small"></div>
                </div>
                <div class="modal-footer">
                    <button id="create-node-button" class="btn btn-primary">Create</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">System Settings</h5>
                    <button type="button" class="btn-close btn-close-white" id="close-settings-modal-button"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4 border-end border-secondary">
                            <div class="nav flex-column nav-pills" id="settings-tabs" role="tablist">
                                <button class="nav-link active text-start" data-bs-toggle="pill" data-bs-target="#settings-ai">AI Providers</button>
                                <button class="nav-link text-start" data-bs-toggle="pill" data-bs-target="#settings-github">GitHub</button>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="settings-ai">
                                    <h6 class="text-white mb-3">Model Configuration</h6>
                                    <div class="mb-3">
                                        <label>Provider</label>
                                        <select id="ai-provider-select" class="form-select">
                                            <option value="gemini">Google Gemini</option>
                                            <option value="nscale">nscale</option>
                                        </select>
                                    </div>
                                    <div id="gemini-settings-container">
                                        <div class="mb-3">
                                             <label>Model</label>
                                             <select id="gemini-model-select" class="form-select">
                                                <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                                                <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                                             </select>
                                        </div>
                                        <div class="mb-3">
                                            <label>API Key</label>
                                            <div class="input-group">
                                                <input type="password" id="api-key-input" class="form-control" placeholder="Gemini API Key">
                                                <button id="save-api-key-button" class="btn btn-outline-success">Save</button>
                                            </div>
                                            <div id="api-key-status" class="small mt-1"></div>
                                        </div>
                                    </div>
                                    <div id="nscale-api-key-container" style="display: none;">
                                        <div class="mb-3">
                                            <label>nscale API Key</label>
                                            <div class="input-group">
                                                <input type="password" id="nscale-api-key-input" class="form-control">
                                                <button id="save-nscale-api-key-button" class="btn btn-outline-success">Save</button>
                                            </div>
                                            <div id="nscale-api-key-status" class="small mt-1"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="settings-github">
                                    <h6 class="text-white mb-3">GitHub Integration</h6>
                                    <div id="github-pat-form">
                                        <div class="mb-3">
                                            <label>Personal Access Token (repo scope)</label>
                                            <div class="input-group">
                                                <input type="password" id="github-pat-input" class="form-control" placeholder="ghp_...">
                                                <button id="save-github-pat-button" class="btn btn-outline-success">Connect</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="github-status" class="mb-3"></div>
                                    <button id="logout-github-button" class="btn btn-outline-danger btn-sm" style="display:none;">Disconnect</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Node Modal -->
    <div id="edit-node-modal" class="modal">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content h-100">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Component</h5>
                    <button type="button" class="btn-close btn-close-white" id="close-edit-node-modal-button"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label>Node ID</label>
                            <input type="text" id="edit-node-id" readonly class="form-control bg-dark text-muted">
                        </div>
                        <div class="col-md-6">
                            <label>Type</label>
                            <input type="text" id="edit-node-type" readonly class="form-control bg-dark text-muted">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label>AI Description</label>
                        <div class="input-group">
                            <textarea id="edit-node-description" class="form-control" rows="2"></textarea>
                            <button id="ai-improve-description-button" class="btn btn-outline-primary"><i class="bi bi-magic"></i></button>
                        </div>
                    </div>

                    <div class="mb-3 h-50 d-flex flex-column">
                        <label>Code</label>
                        <textarea id="edit-node-code" class="form-control flex-grow-1 font-monospace" style="min-height: 300px;"></textarea>
                    </div>
                    <div id="edit-node-error" class="text-danger"></div>
                </div>
                <div class="modal-footer">
                    <button id="save-as-component-button" class="btn btn-outline-secondary">Save to Library</button>
                    <button id="save-edit-node-button" class="btn btn-primary">Save & Update</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Global Loading Overlay -->
    <div id="global-agent-loader" style="display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 9999; align-items: center; justify-content: center; flex-direction: column;">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div>
        <div class="mt-3 text-white text-center">
            <h4 id="global-agent-status-text">Agent Working...</h4>
            <p id="global-agent-progress-text" class="text-muted">Please wait</p>
        </div>
    </div>

    <!-- Other modals (AI Structure, AI Controls, GitHub Save, etc.) kept but styled via CSS classes -->
    <div id="ai-structure-modal" class="modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>AI Structure Refactor</h5>
                    <button type="button" class="btn-close btn-close-white close-button" id="ai-structure-close-button"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted small">Describe how to reorganize the Vibe Tree.</p>
                    <textarea id="ai-structure-prompt-input" class="form-control" rows="5" placeholder="e.g., 'Move the login button into the header...'"></textarea>
                    <p id="ai-structure-error" class="text-danger small mt-2"></p>
                </div>
                <div class="modal-footer">
                    <button id="ai-structure-execute-button" class="btn btn-primary">Update Structure</button>
                </div>
            </div>
        </div>
    </div>

    <div id="ai-project-edit-modal" class="modal">
         <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 id="ai-project-edit-modal-title">AI Command</h5>
                    <button id="ai-project-edit-close-button" class="btn-close btn-close-white"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="ai-project-edit-node-id">
                    <textarea id="ai-project-edit-prompt-input" class="form-control" rows="4" placeholder="What should the AI do with this element?"></textarea>
                    <p id="ai-project-edit-error" class="text-danger mt-2"></p>
                </div>
                <div class="modal-footer">
                    <button id="ai-project-edit-execute-button" class="btn btn-primary">Execute</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="context-component-modal" class="modal">
         <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                     <h5 id="component-modal-title">Component Library</h5>
                     <button id="close-context-modal-button" class="btn-close btn-close-white"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3 border-bottom border-secondary pb-3">
                        <label>Generate with AI</label>
                        <div class="input-group">
                            <textarea id="component-ai-prompt-input" class="form-control" rows="2" placeholder="e.g., 'A responsive pricing card'"></textarea>
                            <button id="generate-component-button" class="btn btn-primary">Generate</button>
                        </div>
                    </div>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label>ID</label>
                            <input type="text" id="component-id-input" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label>Display Name</label>
                            <input type="text" id="component-name-input" class="form-control">
                        </div>
                        <div class="col-12">
                            <label>Description</label>
                            <textarea id="component-description-input" class="form-control" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="row mt-3 g-3">
                        <div class="col-4">
                            <label>HTML</label>
                            <textarea id="component-html-input" class="form-control font-monospace small" rows="5"></textarea>
                        </div>
                         <div class="col-4">
                            <label>CSS</label>
                            <textarea id="component-css-input" class="form-control font-monospace small" rows="5"></textarea>
                        </div>
                         <div class="col-4">
                            <label>JS</label>
                            <textarea id="component-js-input" class="form-control font-monospace small" rows="5"></textarea>
                        </div>
                    </div>
                    <div id="component-modal-error" class="text-danger mt-2"></div>
                </div>
                <div class="modal-footer">
                    <button id="delete-component-button" class="btn btn-danger me-auto" style="display: none;">Delete</button>
                    <button id="save-component-button" class="btn btn-success">Save Component</button>
                </div>
            </div>
        </div>
    </div>

     <div id="github-save-modal" class="modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>Save to GitHub</h5>
                    <button id="close-github-save-modal-button" class="btn-close btn-close-white"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label>Repository</label>
                        <select id="github-save-repo-select" class="form-select"></select>
                    </div>
                    <div class="mb-3">
                         <label>Branch</label>
                         <select id="github-save-branch-select" class="form-select"></select>
                    </div>
                    <div class="mb-3">
                        <label>Commit Message</label>
                        <input type="text" id="github-save-commit-message" class="form-control" placeholder="Update website">
                    </div>
                    <p id="github-save-error" class="text-danger"></p>
                </div>
                <div class="modal-footer">
                    <button id="execute-github-save-button" class="btn btn-success">Commit & Push</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="ai-controls-modal" class="modal">
         <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 id="ai-controls-modal-title">Generate Controls</h5>
                    <span id="ai-controls-close-button" class="btn-close btn-close-white"></span>
                </div>
                 <div class="modal-body">
                    <input type="hidden" id="ai-controls-node-id">
                    <p class="text-muted">Describe controls (e.g., "sliders for padding, color picker for background").</p>
                    <textarea id="ai-controls-prompt-input" class="form-control" rows="3"></textarea>
                    <div id="ai-controls-error" class="text-danger mt-2"></div>
                </div>
                <div class="modal-footer">
                    <button id="ai-controls-execute-button" class="btn btn-primary">Generate</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="app3.js"></script>

</body>
</html>
